---
title: "ChIP-seq analysis workflow with gVenn using A549 datasets: identifying binding site overlaps"
subtitle: "Supplementary data S1"
output-file: "supp_data_S1"
format:
  html:
    toc: true
    toc-depth: 2
    toc-location: left
    number-sections: true
    code-fold: false
    code-tools: true
    code-block-bg: true
    code-block-border-left: "#047857"
    theme: 
      - journal
      - custom.scss
    embed-resources: true
    fig-width: 7
    fig-height: 5
    fig-align: center
    include-in-header:
      - text: |
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-4389F94LTN"></script>
      - text: |
           <script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());
              gtag('config', 'G-4389F94LTN');
            </script>
execute:
  echo: true
  warning: false
  message: false
---

Last updated: 11 February 2026

::: {.callout-note icon=false}
## Interactive notebook
This analysis workflow is available online at:  
**<https://ckntav.github.io/gVenn_manuscript/supp_data_S1.html>**
:::

<p align="center">
<img src="img/gVenn_hex_sticker.png" width="150"/>
</p>

# Overview

This supplementary material demonstrates a complete ChIP-seq analysis workflow using the **gVenn** R package with A549 cell line data. The workflow includes:

- Loading ChIP-seq peak data
- Computing overlaps between genomic regions
- Visualizing results with Venn diagrams and UpSet plots
- Extracting specific overlap groups for downstream analysis
- Exporting results

# Installation

The gVenn package is available through Bioconductor and GitHub.

You can install it from Bioconductor using:

```{r}
#| label: installation-bioconductor
#| eval: false

# From Bioconductor
if (!require("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("gVenn")
```

To install the development version from GitHub, use:

```{r}
#| label: installation-github
#| eval: false

# install.packages("pak")  # if not already installed
pak::pak("ckntav/gVenn")

# or, alternatively:
# install.packages("devtools")  # if not already installed
devtools::install_github("ckntav/gVenn")
```

# Load required packages

```{r}
#| label: setup

library(gVenn)
library(GenomicRanges)
library(knitr)
library(tidyverse)
library(kableExtra)
```

## Checking gVenn version

```{r}
#| label: package-version

packageVersion("gVenn")
```

# Dataset description

The dataset consists of ChIP-seq peaks from A549 cells (lung adenocarcinoma cell line) after dexamethasone treatment for two transcriptional coregulators and a transcription factor:

- **MED1**: Mediator complex subunit 1
- **BRD4**: Bromodomain-containing protein 4
- **GR**: Glucocorticoid receptor

These data represent binding sites identified from ChIP-seq experiments.
To keep the dataset small and suitable for examples and tests, each set has been
restricted to peaks located on *chromosome 7*.

The data originate from Tav *et al.* (2023)
(<a href="https://doi.org/10.3389/fgene.2023.1237092" target="_blank">doi:10.3389/fgene.2023.1237092</a>).

# Load ChIP-seq data

The **gVenn** package includes example ChIP-seq peak data for the A549 cell line.

## Locate data files

First, we locate the BED files included in the package:

```{r}
#| label: locate-file

# Locate the gzipped BED files inside inst/extdata/ of the installed package
bed_med1 <- system.file("extdata", "A549_MED1_Dex.stdchr.bed.gz", package = "gVenn")
bed_brd4 <- system.file("extdata", "A549_BRD4_Dex.stdchr.bed.gz", package = "gVenn")
bed_gr   <- system.file("extdata", "A549_GR_Dex.stdchr.bed.gz", package = "gVenn")
```

## Import peak data

Next, we import the peak sets using `rtracklayer`:

```{r}
#| label: import-peaks

# Import full consensus peak sets
med1_full <- rtracklayer::import(bed_med1)
brd4_full <- rtracklayer::import(bed_brd4)
gr_full   <- rtracklayer::import(bed_gr)
```

## Filter to chromosome 7

To keep the dataset small and suitable for examples, we restrict the analysis to peaks on chromosome 7:

```{r}
#| label: filter-chr7

# Helper function: keep only peaks on chr7
keep_chr7 <- function(gr) {
    gr[seqnames(gr) %in% c("chr7", "7")]
}

# Subset each peak set to chr7 only (keeps the dataset small and fast for examples)
med1_chr7 <- keep_chr7(med1_full)
brd4_chr7 <- keep_chr7(brd4_full)
gr_chr7 <- keep_chr7(gr_full)
```

## Create GRangesList object

Finally, we combine the filtered peak sets into a single `GRangesList` object:

```{r}
#| label: create-grangeslist

# Combine into a GRangesList with descriptive names
a549_chipseq_peaks <- GRangesList("MED1_Dex_chr7" = med1_chr7,
                                  "BRD4_Dex_chr7" = brd4_chr7,
                                  "GR_Dex_chr7" = gr_chr7)

# Display the structure of the dataset
a549_chipseq_peaks
```

## Dataset summary

```{r}
#| label: dataset-summary

# Create a summary table
summary_df <- data.frame(
  "factor" = gsub("_Dex_chr7", "", names(a549_chipseq_peaks)),
  "number of peaks" = sapply(a549_chipseq_peaks, length),
  check.names = FALSE
)

kable(summary_df, 
      caption = "Summary of ChIP-seq peaks for each factor")
```

# Computing overlaps

The `computeOverlaps()` function analyzes the intersection patterns across all peak sets. For genomic ranges, it identifies regions that overlap between different ChIP-seq samples:

```{r}
#| label: compute-overlaps

# Compute overlaps between ChIP-seq peaks
genomic_overlaps <- computeOverlaps(a549_chipseq_peaks)

# Display the structure of the result
class(genomic_overlaps)
names(genomic_overlaps)
```

# Visualization

## Venn diagram

The `plotVenn()` function creates area-proportional Venn diagrams to visualize the overlaps between ChIP-seq peaks:

```{r}
#| label: fig-venn-basic
#| fig-cap: "Basic Venn diagram showing overlaps between ChIP-seq peaks"
#| fig-width: 7
#| fig-height: 5

# Create a basic Venn diagram
plotVenn(genomic_overlaps)
```

## UpSet plot

For more than **three sets**, a Venn diagram with **areas exactly proportional**
to all intersections is **generally not mathematically attainable**. Solvers
(like those used by `eulerr`) provide **best-effort approximations**, but the
layout can become hard to read. In these cases, an **UpSet plot** is the
recommended visualization because it scales cleanly to many sets and preserves
intersection sizes precisely on bar axes.

For complex overlap patterns, `plotUpSet()` provide an alternative visualization that can be easier to interpret with more than 4 sets:

```{r}
#| label: fig-upset
#| fig-cap: "UpSet plot showing intersection sizes between ChIP-seq peaks"
#| fig-width: 6
#| fig-height: 3

# Create an UpSet plot
plotUpSet(genomic_overlaps,
          comb_col = c( "#D87093",  "#CD3301", "#9370DB", "#008B8B", "#2B70AB", "#FFB027", "#3EA742"))
```

The top bar chart shows intersection sizes for each overlap combination, while the connected dots below indicate which sets participate in each intersection. Horizontal bars on the right show total set sizes. The UpSet representation is particularly useful for comparing more than four sets or when precise quantification of complex overlap patterns is required.

## Export visualization

You can export any visualization using `saveViz()`:

```{r save_plot, eval=FALSE}
venn <- plotVenn(genomic_overlaps)
saveViz(venn,
        output_dir = ".",
        output_file = "figure_gVenn",
        format = "pdf")
```

By default, files are written to the current directory (".").
If you enabled the date option (today), the current date will be prepended
to the filename.

You can also export to PNG or SVG:

```{r save_plot2, eval=FALSE}
# png
saveViz(venn,
        output_dir = ".",
        output_file = "figure_gVenn",
        format = "png")

# pdf
saveViz(venn,
        output_dir = ".",
        output_file = "figure_gVenn",
        format = "svg")
```

By default, the background is white. For presentations or publications with colored backgrounds, figures can be exported with a transparent background using `bg = "transparent"`:

```{r save_plot_transparent, eval=FALSE}
# png
saveViz(venn,
        output_dir = ".",
        output_file = "figure_gVenn_transparent",
        format = "png",
        bg = "transparent")

# svg
saveViz(venn,
        output_dir = ".",
        output_file = "figure_gVenn_transparent",
        format = "svg",
        bg = "transparent")
```

# Extracting overlap groups

The `extractOverlaps()` function retrieves the actual genomic regions for each overlap group, which can be useful for downstream analyses such as:

- Motif enrichment analysis
- Peak annotation to nearby genes
- Functional enrichment analysis
- Export for genome browsers

```{r, extractOverlaps_example1}
groups <- extractOverlaps(genomic_overlaps)
```
```{r, extractOverlaps_example2}
# Display the number of genomic regions per overlap group
sapply(groups, length)
```

## Overlap group naming
When overlaps are computed, each group of elements or genomic regions is
labeled with a binary code that indicates which sets the element belongs to.

- Each digit in the code corresponds to one input set (e.g., A, B, C).
- A 1 means the element is present in that set, while 0 means absent.
- The group names in the output are prefixed with "group_" for clarity.

<div align="center" width="50%">
| Group name   | Meaning                       |
|--------------|-------------------------------|
| `group_100`  | Elements only in **A**        |
| `group_010`  | Elements only in **B**        |
| `group_001`  | Elements only in **C**        |
| `group_110`  | Elements in **A ∩ B** (not C) |
| `group_101`  | Elements in **A ∩ C** (not B) |
| `group_011`  | Elements in **B ∩ C** (not A) |
| `group_111`  | Elements in **A ∩ B ∩ C**     |
</div>

## Extract one particular group
Each overlap group can be accessed directly by name.

For example, to extract all elements that are present in **A ∩ B ∩ C**:

```{r, extractOverlaps_example3}
# Extract elements in group_111 (present in all three sets: MED1, BRD4, and GR)
peaks_in_all_sets <- groups[["group_111"]]

# Display the elements
peaks_in_all_sets
```

# Export overlap groups

Each overlap group (e.g., `group_100`, `group_110`, `group_111`) can be
exported for downstream analysis. The gVenn package provides two export functions
depending on your data type and downstream needs:

## For all overlap types (genomic or gene sets):

The function `exportOverlaps()` writes each group to an Excel file with one
sheet per overlap group, making it easy to review and reuse the results outside
of R.

```{r, exportOverlaps, eval=FALSE}
# export overlaps to Excel file
exportOverlaps(groups,
               output_dir = ".",
               output_file = "overlap_groups")
```

## For genomic overlaps only: 

When working with genomic regions (GRanges objects), you can export overlap
groups as BED files using `exportOverlapsToBed()`. This creates one BED file
per overlap group, which is ideal for visualization in genome browsers (IGV,
UCSC Genome Browser) or for downstream analyses requiring BED format input.

```{r, exportOverlapsToBed, eval=FALSE}
# Export genomic overlaps to BED files
exportOverlapsToBed(groups,
                    output_dir = ".",
                    output_prefix = "overlaps")

# This will create separate BED files such as:
# - overlaps_group_100.bed
# - overlaps_group_110.bed
# - overlaps_group_111.bed
# etc.
```

# Customization examples

This section shows common ways to customize the Venn diagram produced by `plotVenn()`.

```{r venn-custom-default, fig.width=6, fig.height=4, fig.align="center"}
# basic default venn plot (uses package defaults)
plotVenn(genomic_overlaps)
```

## Custom fills with transparency
``` {r venn-custom-fills, fig.width=6, fig.height=4, fig.align="center"}
plotVenn(genomic_overlaps,
         fills = list(fill = c("#FF6B6B", "#4ECDC4", "#45B7D1"), alpha = 0.5),
         legend = "right",
         main = list(label = "Custom fills (transparent)", fontsize = 14))
```

## Colored edges, no fills (colored borders only)
``` {r venn-transparent-fills, fig.width=6, fig.height=4, fig.align="center"}
plotVenn(genomic_overlaps,
         fills = "transparent",
         edges = list(col = c("red", "blue", "darkgreen"), lwd = 2),
         main = list(label = "Colored borders only"))
```

## Custom labels and counts + percentages
``` {r venn-labels-quantities, fig.width=6, fig.height=4, fig.align="center"}
plotVenn(genomic_overlaps,
         labels = list(col = "black", fontsize = 12, font = 2),
         quantities = list(type = c("counts","percent"),
                           col = "black", fontsize = 10),
         main = list(label = "Counts + Percentages", fontsize = 14))
```

## Legend at the bottom with custom text
``` {r venn-legend-bottom, fig.width=6, fig.height=4, fig.align="center"}
plotVenn(genomic_overlaps,
         legend = list(side = "bottom",
                       labels = c("Treatment A","Treatment B","Control"),
                       fontsize = 10),
         main = list(label = "Custom legend"))
```

## Combining multiple custom options
``` {r venn-multiple-custom, fig.width=6, fig.height=4, fig.align="center"}
plotVenn(genomic_overlaps,
         fills = list(fill = c("#2B70AB", "#FFB027", "#3EA742"), alpha = 0.6),
         edges = list(col = "gray30", lwd = 1.5),
         labels = list(col = "black", fontsize = 7, font = 2),
         quantities = list(type = "counts", col = "black", fontsize = 10),
         main = list(label = "multiple custom options Venn", fontsize = 16, font = 2),
         legend = FALSE)
```

# References

For more information about the gVenn package, visit:

- Package documentation: [https://ckntav.github.io/gVenn](https://ckntav.github.io/gVenn)
- GitHub repository: [https://github.com/ckntav/gVenn](https://github.com/ckntav/gVenn)

# Session information

```{r}
#| label: session-info
#| code-fold: true
sessionInfo()
```

```{=html}
<!-- Copyright Footer -->
<div class="copyright-footer">
    <p>&copy; 2026 <a href="https://ckntav.github.io/" target="_blank">Christophe Tav</a></p>
</div>
```