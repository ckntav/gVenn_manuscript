---
title: "ChIP-seq analysis workflow with gVenn using A549 datasets: identifying binding site overlaps"
subtitle: "Supplementary data S1"
output-file: "supp_data_S1"
format:
  html:
    toc: true
    toc-depth: 2
    toc-location: left
    number-sections: true
    code-fold: false
    code-tools: true
    code-block-bg: true
    code-block-border-left: "#047857"
    theme: 
      - journal
      - custom.scss
    embed-resources: true
    fig-width: 7
    fig-height: 5
    fig-align: center
    include-in-header:
      - text: |
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-4389F94LTN"></script>
      - text: |
           <script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());
              gtag('config', 'G-4389F94LTN');
            </script>
execute:
  echo: true
  warning: false
  message: false
---

Last updated: 06 December 2025 

::: {.callout-note icon=false}
## Interactive notebook
This analysis workflow is available online at:  
**<https://ckntav.github.io/gVenn_manuscript/supp_data_S1.html>**
:::

<p align="center">
<img src="img/gVenn_hex_sticker.png" width="150"/>
</p>

# Overview

This supplementary material demonstrates a complete ChIP-seq analysis workflow using the **gVenn** R package with A549 cell line data. The workflow includes:

- Loading ChIP-seq peak data
- Computing overlaps between genomic regions
- Visualizing results with Venn diagrams and UpSet plots
- Extracting specific overlap groups for downstream analysis
- Exporting results

# Installation

The gVenn package is available through Bioconductor and GitHub.

You can install it from Bioconductor using:

```{r}
#| label: installation-bioconductor
#| eval: false

# From Bioconductor
if (!require("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("gVenn")
```

To install the development version from GitHub, use:

```{r}
#| label: installation-github
#| eval: false

# install.packages("pak")  # if not already installed
pak::pak("ckntav/gVenn")

# or, alternatively:
# install.packages("devtools")  # if not already installed
devtools::install_github("ckntav/gVenn")
```

# Load required packages

```{r}
#| label: setup

library(gVenn)
library(GenomicRanges)
library(knitr)
library(tidyverse)
library(kableExtra)
```

## Checking gVenn version

```{r}
#| label: package-version

packageVersion("gVenn")
```

# Dataset description

The dataset consists of ChIP-seq peaks from A549 cells (lung adenocarcinoma cell line) after dexamethasone treatment for two transcriptional coregulators and a transcription factor:

- **MED1**: Mediator complex subunit 1
- **BRD4**: Bromodomain-containing protein 4
- **GR**: Glucocorticoid receptor

These data represent binding sites identified from ChIP-seq experiments.
To keep the dataset small and suitable for examples and tests, each set has been
restricted to peaks located on *chromosome 7*.

The data originate from Tav *et al.* (2023)
(<a href="https://doi.org/10.3389/fgene.2023.1237092" target="_blank">doi:10.3389/fgene.2023.1237092</a>).

# Load ChIP-seq data

The **gVenn** package includes example ChIP-seq peak data for the A549 cell line.

## Locate data files

First, we locate the BED files included in the package:

```{r}
#| label: locate-file

# Locate the gzipped BED files inside inst/extdata/ of the installed package
bed_med1 <- system.file("extdata", "A549_MED1_Dex.stdchr.bed.gz", package = "gVenn")
bed_brd4 <- system.file("extdata", "A549_BRD4_Dex.stdchr.bed.gz", package = "gVenn")
bed_gr   <- system.file("extdata", "A549_GR_Dex.stdchr.bed.gz", package = "gVenn")
```

## Import peak data

Next, we import the peak sets using `rtracklayer`:

```{r}
#| label: import-peaks

# Import full consensus peak sets
med1_full <- rtracklayer::import(bed_med1)
brd4_full <- rtracklayer::import(bed_brd4)
gr_full   <- rtracklayer::import(bed_gr)
```

## Filter to chromosome 7

To keep the dataset small and suitable for examples, we restrict the analysis to peaks on chromosome 7:

```{r}
#| label: filter-chr7

# Helper function: keep only peaks on chr7
keep_chr7 <- function(gr) {
    gr[seqnames(gr) %in% c("chr7", "7")]
}

# Subset each peak set to chr7 only (keeps the dataset small and fast for examples)
med1_chr7 <- keep_chr7(med1_full)
brd4_chr7 <- keep_chr7(brd4_full)
gr_chr7 <- keep_chr7(gr_full)
```

## Create GRangesList object

Finally, we combine the filtered peak sets into a single `GRangesList` object:

```{r}
#| label: create-grangeslist

# Combine into a GRangesList with descriptive names
a549_chipseq_peaks <- GRangesList("MED1_Dex_chr7" = med1_chr7,
                                  "BRD4_Dex_chr7" = brd4_chr7,
                                  "GR_Dex_chr7" = gr_chr7)

# Display the structure of the dataset
a549_chipseq_peaks
```

## Dataset summary

```{r}
#| label: dataset-summary

# Create a summary table
summary_df <- data.frame(
  "factor" = gsub("_Dex_chr7", "", names(a549_chipseq_peaks)),
  "number of peaks" = sapply(a549_chipseq_peaks, length),
  check.names = FALSE
)

kable(summary_df, 
      caption = "Summary of ChIP-seq peaks for each factor")
```

# Computing overlaps

The `computeOverlaps()` function analyzes the intersection patterns across all peak sets. For genomic ranges, it identifies regions that overlap between different ChIP-seq samples:

```{r}
#| label: compute-overlaps

# Compute overlaps between ChIP-seq peaks
genomic_overlaps <- computeOverlaps(a549_chipseq_peaks)

# Display the structure of the result
class(genomic_overlaps)
names(genomic_overlaps)
```

# Visualization

## Venn diagram

The `plotVenn()` function creates area-proportional Venn diagrams to visualize the overlaps between ChIP-seq peaks:

```{r}
#| label: fig-venn-basic
#| fig-cap: "Basic Venn diagram showing overlaps between ChIP-seq peaks"
#| fig-width: 7
#| fig-height: 5

# Create a basic Venn diagram
plotVenn(genomic_overlaps)
```

## UpSet plot

For complex overlap patterns, `plotUpSet()` provide an alternative visualization that can be easier to interpret with more than 4 sets:

```{r}
#| label: fig-upset
#| fig-cap: "UpSet plot showing intersection sizes between ChIP-seq peaks"
#| fig-width: 6
#| fig-height: 3

# Create an UpSet plot
plotUpSet(genomic_overlaps,
          comb_col = c( "#D87093",  "#CD3301", "#9370DB", "#008B8B", "#2B70AB", "#FFB027", "#3EA742"))
```

The top bar chart shows intersection sizes for each overlap combination, while the connected dots below indicate which sets participate in each intersection. Horizontal bars on the right show total set sizes. The UpSet representation is particularly useful for comparing more than four sets or when precise quantification of complex overlap patterns is required.

# Extracting overlap groups

The `extractOverlaps()` function extracts the actual genomic regions for each overlap group, which can be useful for downstream analyses such as:

- Motif enrichment analysis
- Peak annotation to nearby genes
- Functional enrichment analysis
- Export for genome browsers

```{r}
#| label: extract-groups

# Extract all overlap groups
overlap_groups <- extractOverlaps(genomic_overlaps)

# Display the number of peaks in each group
group_sizes <- sapply(overlap_groups, length)
group_df <- data.frame(
  "Group" = names(group_sizes),
  "Number of Peaks" = group_sizes,
  check.names = FALSE
)

kable(group_df,
      caption = "Number of genomic regions in each overlap group",
      row.names = FALSE)
```

## Example: Peaks shared by all three factors

Let's examine the peaks that are bound by all three factors (MED1, BRD4, and GR):

```{r}
#| label: shared-peaks

# Extract peaks present in all three sets (group_111)
shared_peaks <- overlap_groups[["group_111"]]

# Display information about these shared peaks
cat("Number of peaks bound by all three factors:", length(shared_peaks), "\n\n")

# Show the first 10 shared peaks
head(shared_peaks, 10)
```

# Export results
Check vignette...

# Session information

```{r}
#| label: session-info

sessionInfo()
```

# References

For more information about the gVenn package, visit:

- Package documentation: [https://ckntav.github.io/gVenn/](https://ckntav.github.io/gVenn/)
- GitHub repository: [https://github.com/ckntav/gVenn](https://github.com/ckntav/gVenn)

```{=html}
<!-- Copyright Footer -->
<div class="copyright-footer">
    <p>&copy; 2025 <a href="https://ckntav.github.io/" target="_blank">Christophe Tav</a></p>
</div>
```